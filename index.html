<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Verificación de Certificados - XIII Curso DPI 2026</title>
  <style>
    body{
      font-family: Arial, sans-serif;
      background:#f4f6f9;
      text-align:center;
      padding:40px;
    }
    .box{
      background:#fff;
      padding:30px;
      border-radius:14px;
      max-width:560px;
      margin:auto;
      box-shadow:0 8px 24px rgba(0,0,0,.08);
    }
    h2{ margin:0 0 8px; }
    p{ margin:6px 0; }
    input{
      padding:12px;
      width:90%;
      max-width:420px;
      margin:14px 0 10px;
      border:1px solid #cfd6df;
      border-radius:10px;
      font-size:16px;
    }
    button{
      padding:12px 22px;
      background:#0b3c5d;
      color:#fff;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-size:16px;
    }
    button:disabled{
      opacity:.6;
      cursor:not-allowed;
    }
    .msg{
      margin-top:16px;
      padding:14px;
      border-radius:12px;
      text-align:left;
      max-width:520px;
      margin-left:auto;
      margin-right:auto;
      border:1px solid #e6e9ee;
      background:#fbfbfc;
    }
    .error{
      border-color:#ffd4d4;
      background:#fff5f5;
      color:#b00020;
    }
    .ok{
      border-color:#cfead6;
      background:#f3fff6;
      color:#0b5d2a;
    }
    .row{
      display:flex;
      justify-content:space-between;
      gap:14px;
      padding:6px 0;
      border-bottom:1px dashed #e8ecf2;
    }
    .row:last-child{ border-bottom:none; }
    .k{ color:#455; font-weight:700; min-width:170px; }
    .v{ color:#111; text-align:right; flex:1; }
    .foot{ margin-top:18px; font-size:12px; color:#667; }
  </style>
</head>

<body>
  <div class="box">
    <h2>Verificación Oficial de Certificados</h2>
    <p>XIII Curso de Diagnóstico por Imágenes 2026</p>
    <p>Avalado por el Colegio Médico del Perú (CMP)</p>

    <input id="codigo" type="text" placeholder="Ingrese código del certificado (ej: DPI2026-...)" />
    <br />
    <button id="btn" onclick="verificar()">Verificar</button>

    <div id="resultado" class="msg" style="display:none;"></div>

    <div class="foot">Sistema oficial de validación digital.</div>
  </div>

  <script>
    // ✅ TU API (Apps Script Web App)
    const API_URL = "https://script.google.com/macros/s/AKfycbzaKAqCZO-kTJufqeQJbP725Wdj4Og-2KeDHyF8sMoE1yivyzNjgHrWnOxPkw7G-Cve/exec";

    const $ = (id) => document.getElementById(id);

    function showBox(html, type){
      const r = $("resultado");
      r.style.display = "block";
      r.className = "msg " + (type || "");
      r.innerHTML = html;
    }

    function row(k,v){
      return `<div class="row"><div class="k">${k}</div><div class="v">${v ?? ""}</div></div>`;
    }

    async function verificar(){
      const codigo = $("codigo").value.trim().toUpperCase();
      if(!codigo){
        showBox("Ingrese un código para verificar.", "error");
        return;
      }

      const btn = $("btn");
      btn.disabled = true;
      btn.textContent = "Verificando...";

      try{
        const url = `${API_URL}?codigo=${encodeURIComponent(codigo)}`;
        const res = await fetch(url, { method: "GET" });
        const text = await res.text();

        let data;
        try{
          data = JSON.parse(text);
        }catch(e){
          showBox("Error: Respuesta no válida del servidor.", "error");
          return;
        }

        if(data.error){
          showBox(`No encontrado. Verifique el código e intente nuevamente.<br><br><b>Detalle:</b> ${data.error}`, "error");
          return;
        }

        // Ajustado a tus encabezados reales (según tu hoja):
        const html =
          `<b>✅ Certificado válido</b><br><br>` +
          row("Código", data["Código"]) +
          row("Apellidos", data["Apellidos completos"]) +
          row("Nombres", data["Nombres completos"]) +
          row("DNI (oculto)", data["DNI oculto"]) +
          row("Modalidad inscripción", data["Modalidad de Inscripción"]) +
          row("Modalidad elegida", data["Modalidad elegida"]) +
          row("Estado", data["Estado"]) +
          row("Tipo de certificado", data["Tipo de Certificado"]) +
          row("Fecha de emisión", data["Fecha de emisión"]);

        showBox(html, "ok");

      }catch(err){
        showBox("Error: No se pudo conectar con el servidor. Intente nuevamente.", "error");
      }finally{
        btn.disabled = false;
        btn.textContent = "Verificar";
      }
    }

    // Enter = verificar
    document.addEventListener("keydown", (e) => {
      if(e.key === "Enter") verificar();
    });
  </script>
</body>
</html>
