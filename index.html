<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Verificación de Certificados - XIII Curso DPI 2026</title>
  <style>
    body{
      font-family: Arial, sans-serif;
      background:#f4f6f9;
      text-align:center;
      padding:40px;
    }
    .box{
      background:#fff;
      padding:30px;
      border-radius:14px;
      max-width:560px;
      margin:0 auto;
      box-shadow:0 8px 24px rgba(0,0,0,.08);
    }
    input{
      padding:12px;
      width:90%;
      max-width:420px;
      margin:14px 0;
      font-size:16px;
      border:1px solid #cfd6de;
      border-radius:10px;
      outline:none;
    }
    button{
      padding:12px 22px;
      background:#0b3c5d;
      color:#fff;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-size:16px;
    }
    button:disabled{
      opacity:.6;
      cursor:not-allowed;
    }
    .result{
      margin-top:18px;
      text-align:left;
      background:#f8fafc;
      border:1px solid #e5e9ef;
      border-radius:12px;
      padding:16px;
      display:none;
      word-break:break-word;
    }
    .ok{ color:#0a7a2f; font-weight:700; }
    .bad{ color:#b00020; font-weight:700; }
    .muted{ color:#5b6773; font-size:13px; margin-top:16px; }
    .row{ margin:6px 0; }
    .label{ font-weight:700; }
  </style>
</head>

<body>
  <div class="box">
    <h2>Verificación Oficial de Certificados</h2>
    <p>XIII Curso de Diagnóstico por Imágenes 2026</p>
    <p>Avalado por el Colegio Médico del Perú (CMP)</p>

    <input id="codigo" type="text" placeholder="Ingrese código del certificado (ej: DPI2026-NOUNMSM-BAS-001)" />
    <br />
    <button id="btn">Verificar</button>

    <div id="result" class="result"></div>

    <p class="muted">Sistema oficial de validación digital.</p>
  </div>

  <script>
    // ✅ PEGA AQUÍ TU URL EXACTA que te funciona en el navegador (script.googleusercontent.com)
    const API_URL = "PEGA_AQUI_TU_URL_WEB_APP";

    const $codigo = document.getElementById("codigo");
    const $btn = document.getElementById("btn");
    const $result = document.getElementById("result");

    function show(html){
      $result.innerHTML = html;
      $result.style.display = "block";
    }

    function hide(){
      $result.style.display = "none";
      $result.innerHTML = "";
    }

    function safe(v){ return (v ?? "").toString().trim(); }

    async function verificar(){
      const codigo = safe($codigo.value).toUpperCase();
      hide();

      if(!codigo){
        show(`<div class="bad">Ingrese un código.</div>`);
        return;
      }

      $btn.disabled = true;
      $btn.textContent = "Verificando...";

      try{
        // Tu API devuelve TODO el JSON con data[], aquí lo descargamos y filtramos.
        const url = API_URL; // (sin parámetros)
        const res = await fetch(url, { cache: "no-store" });

        if(!res.ok) throw new Error("Respuesta no válida del servidor");

        const json = await res.json();

        if(!json || !Array.isArray(json.data)){
          throw new Error("Formato JSON inesperado (no existe data[])");
        }

        const encontrado = json.data.find(x => safe(x.codigo).toUpperCase() === codigo);

        if(!encontrado){
          show(`<div class="bad">No se encontró el código: <b>${codigo}</b></div>`);
          return;
        }

        // Mostrar resultado bonito
        const estado = safe(encontrado.estado);
        const estadoClass = (estado.toLowerCase() === "valido" || estado.toLowerCase() === "válido") ? "ok" : "bad";

        show(`
          <div class="${estadoClass}">Estado: ${estado || "—"}</div>
          <div class="row"><span class="label">Código:</span> ${safe(encontrado.codigo)}</div>
          <div class="row"><span class="label">Apellidos:</span> ${safe(encontrado.apellidos)}</div>
          <div class="row"><span class="label">Nombres:</span> ${safe(encontrado.nombres)}</div>
          <div class="row"><span class="label">DNI (oculto):</span> ${safe(encontrado.dni_oculto)}</div>
          <div class="row"><span class="label">Modalidad inscripción:</span> ${safe(encontrado.modalidad_inscripcion)}</div>
          <div class="row"><span class="label">Modalidad elegida:</span> ${safe(encontrado.modalidad_elegida)}</div>
          <div class="row"><span class="label">Tipo certificado:</span> ${safe(encontrado.tipo_certificado)}</div>
          <div class="row"><span class="label">Fecha emisión:</span> ${safe(encontrado.fecha_emision)}</div>
        `);

      }catch(err){
        show(`<div class="bad">Error: ${safe(err.message) || "No se pudo verificar"}</div>`);
      }finally{
        $btn.disabled = false;
        $btn.textContent = "Verificar";
      }
    }

    $btn.addEventListener("click", verificar);
    $codigo.addEventListener("keydown", (e) => {
      if(e.key === "Enter") verificar();
    });
  </script>
</body>
</html>
