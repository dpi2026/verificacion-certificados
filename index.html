<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Verificación de Certificados - XIII Curso DPI 2026</title>

  <style>
    :root{
      --c-navy:#172736;   /* principal */
      --c-blue:#426583;   /* botones */
      --c-sky:#81c3e3;    /* acento */
      --c-mist:#b9cfdb;   /* fondo suave */
      --ok-bg:#f3fff6;
      --ok-border:#cfead6;
      --ok-text:#0b5d2a;
      --err-bg:#fff5f5;
      --err-border:#ffd4d4;
      --err-text:#b00020;
    }

    *{box-sizing:border-box}

    /* ✅ NUEVO: evita "franjas" del fondo */
    html, body{height:100%}

    body{
      font-family: Arial, sans-serif;
      text-align:center;
      padding:40px 16px;
      margin:0;
      color:#111;

      /* ✅ NUEVO: fondo suave sin cortes */
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(129,195,227,.18), transparent 60%),
        radial-gradient(900px 500px at 80% 30%, rgba(185,207,219,.35), transparent 65%),
        linear-gradient(180deg, #ffffff 0%, var(--c-mist) 100%);
      background-attachment: fixed;
    }

    .box{
      background:#fff;
      border-radius:16px;
      max-width:640px;
      margin:0 auto;
      box-shadow:0 10px 30px rgba(0,0,0,.10);
      overflow:hidden; /* para que el header se vea perfecto */
      border:1px solid rgba(0,0,0,.04);
    }

    /* HEADER */
.topbar{
  display:flex;
  align-items:center;
  gap:16px;
  padding:18px 20px;
  background: var(--c-navy);
  color:#fff;
}

/* ✅ Logo MÁS grande pero elegante */
.logo{
  width:92px;
  height:92px;
  border-radius:50%;
  flex:0 0 auto;
  display:flex;
  align-items:center;
  justify-content:center;
}

.logo img{
  width:92px;
  height:92px;
  object-fit:cover;
  display:block;
  border-radius:50%;
  border:3px solid rgba(255,255,255,.92);
  box-shadow:0 10px 22px rgba(0,0,0,.28);
}

/* Un poquito más de jerarquía tipográfica */
.topbar .t1{
  font-weight:800;
  font-size:18px;
  line-height:1.1;
  margin:0;
  text-align:left;
}

.topbar .t2{
  margin:5px 0 0;
  font-size:13px;
  opacity:.9;
  text-align:left;
}

    /* CONTENIDO */
    .content{
      padding:26px 22px 22px;
    }

    h2{
      margin:0 0 6px;
      font-size:20px;
      color:var(--c-navy);
    }

    .sub{
      margin:0 0 14px;
      color:#334;
      font-size:14px;
    }

    .hint{
      font-size:12px;
      color:#667;
      margin:10px 0 10px;
    }

    input{
      padding:12px 14px;
      width:100%;
      max-width:440px;
      margin:10px 0 10px;
      border:1px solid #cfd6df;
      border-radius:12px;
      font-size:16px;
      outline:none;
      transition: box-shadow .15s, border-color .15s;
    }
    input:focus{
      border-color: var(--c-sky);
      box-shadow:0 0 0 4px rgba(129,195,227,.25);
    }

    button{
      padding:12px 24px;
      background: var(--c-blue);
      color:#fff;
      border:none;
      border-radius:12px;
      cursor:pointer;
      font-size:16px;
      font-weight:700;
      transition: transform .05s, filter .15s;
    }
    button:hover{filter:brightness(1.05)}
    button:active{transform:scale(.99)}
    button:disabled{opacity:.6;cursor:not-allowed}

    .msg{
      margin:18px auto 6px;
      padding:16px;
      border-radius:14px;
      text-align:left;
      border:1px solid #e6e9ee;
      background:#fbfbfc;
      max-width:560px;
    }

    .error{
      border-color:var(--err-border);
      background:var(--err-bg);
      color:var(--err-text);
    }

    .ok{
      border-color:var(--ok-border);
      background:var(--ok-bg);
      color:var(--ok-text);
    }

    .row{
      display:flex;
      justify-content:space-between;
      gap:14px;
      padding:7px 0;
      border-bottom:1px dashed #e8ecf2;
    }
    .row:last-child{border-bottom:none}

    .k{
      color:#2c3b4a;
      font-weight:800;
      min-width:190px;
    }

    .v{
      color:#111;
      text-align:right;
      flex:1;
      word-break:break-word;
    }

    .footer{
      padding:12px 18px 16px;
      color:#6a7785;
      font-size:12px;
    }
    /* ✅ Responsive: móvil */
@media (max-width: 520px){

  body{ padding:18px 12px; }

  .topbar{
    padding:14px 14px;
    gap:12px;
  }

  /* logo un poco más chico en móvil para que no empuje el título */
  .logo{ width:72px; height:72px; }
  .logo img{ width:72px; height:72px; }

  .content{ padding:20px 14px 16px; }

  /* ✅ La clave: filas en columna */
  .row{
    flex-direction: column;
    align-items: flex-start;
    gap:6px;
  }

  .k{
    min-width: 0;         /* quita el “bloque fijo” */
    text-align:left;
  }

  .v{
    width: 100%;
    text-align:left;      /* antes estaba right */
    white-space: normal;  /* permite saltos normales */
    word-break: break-word;
  }

  /* input y botón ocupan mejor el ancho */
  input{ max-width: 100%; }
  button{ width: 100%; max-width: 440px; }
}
  </style>
</head>

<body>
  <div class="box">
    <!-- HEADER con logo -->
    <div class="topbar">
      <div class="logo" title="DPI 2026">
        <!-- ✅ tu logo del repo -->
        <img src="./logo.png" alt="Logo DPI 2026">
      </div>
      <div>
        <p class="t1">Verificación Oficial de Certificados</p>
        <p class="t2">XIII Curso de Diagnóstico por Imágenes 2026</p>
      </div>
    </div>

    <div class="content">
      <h2>Validación de Certificado</h2>
      <p class="sub">Ingrese su DNI para consultar el estado del certificado.</p>

      <div class="hint">DNI (8 dígitos). Ejemplo: 12345678</div>

      <input
        id="dni"
        placeholder="DNI (8 dígitos)"
        inputmode="numeric"
        maxlength="8"
        autocomplete="off"
      />
      <br />
      <button id="btn" onclick="verificar()">Verificar</button>

      <div id="resultado" class="msg" style="display:none;"></div>

      <div class="footer">Sistema oficial de validación digital.</div>
    </div>
  </div>

  <script>
    // ✅ Tu Apps Script Web App (URL /exec) - NO CAMBIAR si ya funciona
    const API_URL = "https://script.google.com/macros/s/AKfycbz3zI8QAcc0fukwc8jQBNopqrTfXozKXF59nk7k4euk8BMs2jPmjoB58_SINnzCgRXb/exec";
    const $ = (id) => document.getElementById(id);

    function show(html, type){
      const r = $("resultado");
      r.style.display = "block";
      r.className = "msg " + (type || "");
      r.innerHTML = html;
    }

    function row(k,v){
      return `<div class="row"><div class="k">${k}</div><div class="v">${escapeHtml(String(v ?? ""))}</div></div>`;
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
        .replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }

    function formatFecha(val){
      if(!val) return "";
      const d = new Date(val);
      if(!isNaN(d.getTime())) return d.toLocaleDateString("es-PE");
      return String(val);
    }

    // ✅ UX: solo números, max 8
    $("dni").addEventListener("input", () => {
      $("dni").value = $("dni").value.replace(/\D/g, "").slice(0, 8);
    });

    // ✅ Enter SOLO funciona en el input
    $("dni").addEventListener("keydown", (e) => {
      if(e.key === "Enter") verificar();
    });

    async function verificar(){
      const dni = $("dni").value.trim();

      if(!/^\d{8}$/.test(dni)){
        show("El DNI debe tener <b>8 dígitos</b>.", "error");
        return;
      }

      const btn = $("btn");
      btn.disabled = true;
      btn.textContent = "Verificando...";

      try{
        const url = `${API_URL}?dni=${encodeURIComponent(dni)}`;
        const res = await fetch(url, { method:"GET", cache:"no-store" });
        const text = await res.text();

        let data;
        try{ data = JSON.parse(text); } catch(e){
          show("Error: respuesta no válida del servidor.", "error");
          return;
        }

        if(data.error){
          show(`❌ No encontrado.<br><br><b>Detalle:</b> ${escapeHtml(data.error)}`, "error");
          return;
        }

        const html =
          `<b>✅ Certificado encontrado</b><br><br>` +
          row("Código", data["Código"]) +
          row("Apellidos", data["Apellidos completos"]) +
          row("Nombres", data["Nombres completos"]) +
          row("DNI", data["DNI oculto"]) +
          row("Tipo de usuario", data["Tipo de usuario"]) +
          row("Modalidad elegida", data["Modalidad elegida"]) +
          row("Estado", data["Estado"]) +
          row("Tipo de certificado", data["Tipo de Certificado"]) +
          row("Fecha de emisión", formatFecha(data["Fecha de emisión"]));

        const estado = String(data["Estado"] || "").toLowerCase();
        const cls = (estado.includes("valido") || estado.includes("válido")) ? "ok" : "error";
        show(html, cls);

      }catch(err){
        show("Error: no se pudo conectar con el servidor. Intente nuevamente.", "error");
      }finally{
        btn.disabled = false;
        btn.textContent = "Verificar";
      }
    }
  </script>
</body>
</html>
